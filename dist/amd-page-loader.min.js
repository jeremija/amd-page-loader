/*! amd-page-loader https://github.com/jeremija/amd-page-loader 25-11-2013 */
define(["jquery","extendable"],function(a,b){var c={init:function(b){var c=a(b.selector);if(0===c.length)throw new Error("element "+b.selector+" not found");return this.extend({config:b,$element:c})},success:function(a){return this.callback=a,this},fail:function(a){return this.errback=a,this},load:function(a){var b=this.lastRequestTimestamp=(new Date).getTime(),c=this._getHtmlUrl(a),d=this._getScriptUrl(a),e=this._getPageId(a),f=this.$element.children("#"+e);return f.length?this._showPage(b,f,d,e):this._loadNewPage(b,d,c,e),this},_getScriptUrl:function(a){return this.config.jsPrefix?this.config.jsPrefix+"/"+a:a},_getHtmlUrl:function(a){var b=this.config.htmlPrefix?this.config.htmlPrefix+"/"+a:a;return b+".html"},_getPageId:function(a){var b=this.config.pagePrefix||"page-";return b+a.replace(/[^a-zA-Z0-9\-]/g,"_")},_checkExpired:function(a){return this.lastRequestTimestamp>a},_showPage:function(a,b,c){var d=this;require([c],function(c){if(d.callback){var e=d._checkExpired(a);d.callback(c,b[0],e)}},function(b){if(d.errback){var c=d._checkExpired(a);return d.errback(b,c),void 0}throw b})},_loadNewPage:function(b,c,d,e){function f(a){h=a}var g,h,i=this,j=this.$element,k=a("<div>").attr("id",e).hide().appendTo(j),l=a.Deferred().done(function(a){g=a}).fail(f),m=a.Deferred().fail(f);this._loadHtml(k,d,m),this._loadScript(c,l),a.when(l,m).then(function(){if(i.callback){var a=i._checkExpired(b);i.callback(g,k[0],a)}},function(){if(i.errback){var a=i._checkExpired(b);return i.errback(h,a),void 0}throw h})},_loadHtml:function(a,b,c){a.load(b,function(d,e,f){return"error"===e?(c.reject(new Error("Error loading "+b+": "+f.status)),void 0):(c.resolve(a),void 0)})},_loadScript:function(a,b){require([a],function(a){b.resolve(a)},function(a){b.reject(a)})}};return b.extend(c).create()});